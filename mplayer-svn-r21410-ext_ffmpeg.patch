diff -urN mplayer-svn-r21410.orig/configure mplayer-svn-r21410/configure
--- mplayer-svn-r21410.orig/configure	2006-11-29 17:14:35 +0200
+++ mplayer-svn-r21410/configure	2006-12-01 16:09:21 +0200
@@ -286,10 +286,12 @@
   --disable-libavcodec      disable libavcodec [autodetect]
   --disable-libavformat     disable libavformat [autodetect]
   --disable-libpostproc     disable libpostproc [autodetect]
+  --disable-libswscale      disable libswscale [autodetect]
   --disable-libavutil_so    disable shared libavutil [autodetect]
   --disable-libavcodec_so   disable shared libavcodec [autodetect]
   --disable-libavformat_so  disable shared libavformat [autodetect]
   --disable-libpostproc_so  disable shared libpostproc [autodetect]
+  --disable-libswscale_so disable shared libswscale [autodetect]
   --disable-libavcodec_mpegaudio_hp disable high precision audio decoding
                                     in libavcodec [enabled]
   --disable-tremor-internal disable internal Tremor [enabled]
@@ -1597,6 +1599,8 @@
 _libavformat_so=auto
 _libpostproc=auto
 _libpostproc_so=auto
+_libswscale=auto
+_libswscale_so=auto
 _libavcodec_mpegaudio_hp=yes
 _mencoder=yes
 _mplayer=yes
@@ -1998,6 +2002,10 @@
   --disable-libpostproc)	_libpostproc=no		;;
   --enable-libpostproc_so)	_libpostproc_so=yes	;;
   --disable-libpostproc_so)	_libpostproc_so=no	;;
+  --enable-libswscale)		_libswscale=yes		;;
+  --disable-libswscale)		_libswscale=no		;;
+  --enable-libswscale_so)	_libswscale_so=yes	;;
+  --disable-libswscale_so)	_libswscale_so=no	;;
   --enable-libavcodec_mpegaudio_hp)	_libavcodec_mpegaudio_hp=yes	;;
   --disable-libavcodec_mpegaudio_hp)	_libavcodec_mpegaudio_hp=no	;;
 
@@ -6117,6 +6125,15 @@
 fi
 echores "$_libpostproc"
 
+echocheck "FFmpeg libswscale (static)"
+if test "$_libswscale" = auto ; then
+_libswscale=no
+if test -d libswscale && test -f libswscale/swscale.h ; then
+   _libswscale='yes'
+fi
+fi
+echores "$_libswscale"
+
 
 if test "$_libavutil" != yes ; then
 echocheck "FFmpeg libavutil (dynamic)"
@@ -6215,6 +6232,27 @@
 echores "$_libpostproc_so"
 fi #if test "$_libpostproc" != yes ; then
 
+if test "$_libswscale" != yes ; then
+echocheck "FFmpeg libswscale (dynamic)"
+if test "$_libswscale_so" != no ; then
+  _libswscale_so=no
+  cat > $TMPC << EOF
+  #define USE_LIBPOSTPROC 1
+  #include <inttypes.h>
+  #include <ffmpeg/swscale.h>
+  int main(void) {
+      sws_getIdentityVec();
+      return 0;}
+EOF
+  if cc_check -lswscale $_ld_lm ; then
+    _ld_extra="$_ld_extra -lswscale"
+    _libswscale_so=yes
+    _res_comment="using libswscale.so, but static libswscale is recommended"
+  fi
+fi
+echores "$_libswscale_so"
+fi
+
 _def_libavutil='#undef USE_LIBAVUTIL'
 _def_libavutil_so='#undef USE_LIBAVUTIL_SO'
 if test "$_libavutil" = yes ; then
@@ -6268,6 +6306,19 @@
   fi
 fi
 
+_def_libswscale='#undef USE_LIBSWSCALE'
+_def_libswscale_so='#undef USE_LIBSWSCALE_SO'
+if test "$_libswscale" = yes ; then
+  _def_libswscale='#define USE_LIBSWSCALE 1'
+  _ld_libswscale='libswscale/libswscale.a'
+  _dep_libswscale='libswscale/libswscale.a'
+else
+  if test "$_libswscale_so" = yes ; then
+    _def_libswscale_so='#define USE_LIBSWSCALE_SO 1'
+    _ld_libswscale='-lswscale'
+  fi
+fi
+
 echocheck "md5sum support"
 if test "$_md5sum" = yes; then
   _def_md5sum="#define HAVE_MD5SUM"
@@ -7444,6 +7495,10 @@
 CONFIG_LIBAVFORMAT_SO = $_libavformat_so
 CONFIG_LIBPOSTPROC = $_libpostproc
 CONFIG_LIBPOSTPROC_SO = $_libpostproc_so
+CONFIG_LIBSWSCALE = $_libswscale
+CONFIG_SWSCALER = $_libswscale
+CONFIG_LIBSWSCALE_SO = $_libswscale_so
+SWSCALE_LIB = $_ld_libswscale
 ZORAN = $_zr
 LIBDV = $_libdv
 XVID4 = $_xvid
@@ -7803,6 +7858,9 @@
 $_def_libpostproc
 $_def_libpostproc_so
 
+$_def_libswscale
+$_def_libswscale_so
+
 /* Win32 DLL support */
 $_def_win32
 #define WIN32_PATH "$_win32codecsdir"
diff -urN mplayer-svn-r21410.orig/fmt-conversion.h mplayer-svn-r21410/fmt-conversion.h
--- mplayer-svn-r21410.orig/fmt-conversion.h	2006-09-24 19:47:48 +0300
+++ mplayer-svn-r21410/fmt-conversion.h	2006-12-01 16:09:21 +0200
@@ -1,4 +1,8 @@
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/avutil.h>
+#else
 #include "avutil.h"
+#endif
 #include "img_format.h"
 
 enum PixelFormat imgfmt2pixfmt(int fmt)
diff -urN mplayer-svn-r21410.orig/Gui/wm/ws.c mplayer-svn-r21410/Gui/wm/ws.c
--- mplayer-svn-r21410.orig/Gui/wm/ws.c	2006-07-12 16:44:27 +0300
+++ mplayer-svn-r21410/Gui/wm/ws.c	2006-12-01 16:09:21 +0200
@@ -24,8 +24,13 @@
 #include "ws.h"
 #include "wsxdnd.h"
 #include "../cpudetect.h"
+#ifdef USE_LIBSWSCALE_SO
+#include <ffmpeg/swscale.h>
+#include <ffmpeg/rgb2rgb.h>
+#else
 #include "../libswscale/swscale.h"
 #include "../libswscale/rgb2rgb.h"
+#endif
 #include "../libmpcodecs/vf_scale.h"
 #include "../mp_msg.h"
 #include "../help_mp.h"
diff -urN mplayer-svn-r21410.orig/liba52/parse.c mplayer-svn-r21410/liba52/parse.c
--- mplayer-svn-r21410.orig/liba52/parse.c	2006-11-09 16:34:19 +0200
+++ mplayer-svn-r21410/liba52/parse.c	2006-12-01 16:09:22 +0200
@@ -37,7 +37,11 @@
 #include "bitstream.h"
 #include "tables.h"
 #include "mm_accel.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/avutil.h>
+#else
 #include "libavutil/avutil.h"
+#endif
 
 #ifdef HAVE_MEMALIGN
 /* some systems have memalign() but no declaration for it */
diff -urN mplayer-svn-r21410.orig/libaf/af_format.c mplayer-svn-r21410/libaf/af_format.c
--- mplayer-svn-r21410.orig/libaf/af_format.c	2006-11-29 17:14:35 +0200
+++ mplayer-svn-r21410/libaf/af_format.c	2006-12-01 16:09:22 +0200
@@ -22,8 +22,13 @@
 #endif
 
 #include "af.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 #include "libvo/fastmemcpy.h"
 
 /* Functions used by play to convert the input audio to the correct
diff -urN mplayer-svn-r21410.orig/libao2/ao_dxr2.c mplayer-svn-r21410/libao2/ao_dxr2.c
--- mplayer-svn-r21410.orig/libao2/ao_dxr2.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/libao2/ao_dxr2.c	2006-12-01 16:09:22 +0200
@@ -7,8 +7,13 @@
 #include "config.h"
 #include "mp_msg.h"
 #include "help_mp.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 
 #include "audio_out.h"
 #include "audio_out_internal.h"
diff -urN mplayer-svn-r21410.orig/libao2/ao_pcm.c mplayer-svn-r21410/libao2/ao_pcm.c
--- mplayer-svn-r21410.orig/libao2/ao_pcm.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/libao2/ao_pcm.c	2006-12-01 16:09:22 +0200
@@ -4,8 +4,13 @@
 #include <stdlib.h>
 #include <string.h>
 
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 #include "subopt-helper.h"
 #include "libaf/af_format.h"
 #include "audio_out.h"
diff -urN mplayer-svn-r21410.orig/libass/mputils.h mplayer-svn-r21410/libass/mputils.h
--- mplayer-svn-r21410.orig/libass/mputils.h	2006-11-20 12:43:26 +0200
+++ mplayer-svn-r21410/libass/mputils.h	2006-12-01 16:09:22 +0200
@@ -6,6 +6,10 @@
 #include "libvo/font_load.h" // for blur()
 #include "subreader.h" // for guess_buffer_cp
 #include "libvo/sub.h" // for utf8_get_char
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#else
 #include "libavutil/common.h"
+#endif
 
 #endif
diff -urN mplayer-svn-r21410.orig/libdha/sysdep/pci_linux.c mplayer-svn-r21410/libdha/sysdep/pci_linux.c
--- mplayer-svn-r21410.orig/libdha/sysdep/pci_linux.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/libdha/sysdep/pci_linux.c	2006-12-01 16:09:22 +0200
@@ -132,8 +132,13 @@
 #include <fcntl.h>
 //#include <sys/io.h>
 #include <linux/pci.h>
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 
 static int pci_get_vendor(
           unsigned char bus,
diff -urN mplayer-svn-r21410.orig/libmpcodecs/ad_dk3adpcm.c mplayer-svn-r21410/libmpcodecs/ad_dk3adpcm.c
--- mplayer-svn-r21410.orig/libmpcodecs/ad_dk3adpcm.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/libmpcodecs/ad_dk3adpcm.c	2006-12-01 16:09:22 +0200
@@ -16,8 +16,13 @@
 #include <unistd.h>
 
 #include "config.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 #include "ad_internal.h"
 
 static ad_info_t info = 
diff -urN mplayer-svn-r21410.orig/libmpcodecs/ad_ffmpeg.c mplayer-svn-r21410/libmpcodecs/ad_ffmpeg.c
--- mplayer-svn-r21410.orig/libmpcodecs/ad_ffmpeg.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/libmpcodecs/ad_ffmpeg.c	2006-12-01 16:09:22 +0200
@@ -8,7 +8,11 @@
 
 #include "ad_internal.h"
 
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/bswap.h"
+#endif
 
 static ad_info_t info = 
 {
diff -urN mplayer-svn-r21410.orig/libmpcodecs/ad_imaadpcm.c mplayer-svn-r21410/libmpcodecs/ad_imaadpcm.c
--- mplayer-svn-r21410.orig/libmpcodecs/ad_imaadpcm.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/libmpcodecs/ad_imaadpcm.c	2006-12-01 16:09:22 +0200
@@ -21,8 +21,13 @@
 #include <unistd.h>
 
 #include "config.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 #include "ad_internal.h"
 
 #define MS_IMA_ADPCM_PREAMBLE_SIZE 4
diff -urN mplayer-svn-r21410.orig/libmpcodecs/ad_liba52.c mplayer-svn-r21410/libmpcodecs/ad_liba52.c
--- mplayer-svn-r21410.orig/libmpcodecs/ad_liba52.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/libmpcodecs/ad_liba52.c	2006-12-01 16:09:22 +0200
@@ -37,7 +37,11 @@
 float a52_drc_level = 1.0;
 static int a52_drc_action = DRC_NO_ACTION;
 
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/bswap.h"
+#endif
 
 static ad_info_t info = 
 {
diff -urN mplayer-svn-r21410.orig/libmpcodecs/ad_msadpcm.c mplayer-svn-r21410/libmpcodecs/ad_msadpcm.c
--- mplayer-svn-r21410.orig/libmpcodecs/ad_msadpcm.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/libmpcodecs/ad_msadpcm.c	2006-12-01 16:09:22 +0200
@@ -12,8 +12,13 @@
 #include <unistd.h>
 
 #include "config.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 #include "ad_internal.h"
 
 static ad_info_t info = 
diff -urN mplayer-svn-r21410.orig/libmpcodecs/ad_qtaudio.c mplayer-svn-r21410/libmpcodecs/ad_qtaudio.c
--- mplayer-svn-r21410.orig/libmpcodecs/ad_qtaudio.c	2006-11-27 14:05:37 +0200
+++ mplayer-svn-r21410/libmpcodecs/ad_qtaudio.c	2006-12-01 16:09:22 +0200
@@ -14,7 +14,13 @@
 #include "wine/windef.h"
 
 #include "ad_internal.h"
-#include "bswap.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/common.h"
+#include "libavutil/bswap.h"
+#endif
 
 #ifdef WIN32_LOADER
 #include "ldt_keeper.h"
diff -urN mplayer-svn-r21410.orig/libmpcodecs/native/nuppelvideo.c mplayer-svn-r21410/libmpcodecs/native/nuppelvideo.c
--- mplayer-svn-r21410.orig/libmpcodecs/native/nuppelvideo.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/libmpcodecs/native/nuppelvideo.c	2006-12-01 16:09:22 +0200
@@ -13,8 +13,13 @@
 
 #include "config.h"
 #include "mp_msg.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 
 #include "../libvo/fastmemcpy.h"
 
diff -urN mplayer-svn-r21410.orig/libmpcodecs/native/RTjpegN.c mplayer-svn-r21410/libmpcodecs/native/RTjpegN.c
--- mplayer-svn-r21410.orig/libmpcodecs/native/RTjpegN.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/libmpcodecs/native/RTjpegN.c	2006-12-01 16:09:22 +0200
@@ -31,8 +31,13 @@
 #define MMX
 #endif
 
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 #include "RTjpegN.h"
 
 #ifdef MMX
diff -urN mplayer-svn-r21410.orig/libmpcodecs/vd_ffmpeg.c mplayer-svn-r21410/libmpcodecs/vd_ffmpeg.c
--- mplayer-svn-r21410.orig/libmpcodecs/vd_ffmpeg.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/libmpcodecs/vd_ffmpeg.c	2006-12-01 16:09:22 +0200
@@ -7,8 +7,13 @@
 #include "mp_msg.h"
 #include "help_mp.h"
 
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 
 #include "vd_internal.h"
 
diff -urN mplayer-svn-r21410.orig/libmpcodecs/vd_ijpg.c mplayer-svn-r21410/libmpcodecs/vd_ijpg.c
--- mplayer-svn-r21410.orig/libmpcodecs/vd_ijpg.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/libmpcodecs/vd_ijpg.c	2006-12-01 16:09:22 +0200
@@ -11,8 +11,13 @@
 
 #include <setjmp.h>
 
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 #include "libvo/fastmemcpy.h"
 
 #include "vd_internal.h"
diff -urN mplayer-svn-r21410.orig/libmpcodecs/vd_mpng.c mplayer-svn-r21410/libmpcodecs/vd_mpng.c
--- mplayer-svn-r21410.orig/libmpcodecs/vd_mpng.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/libmpcodecs/vd_mpng.c	2006-12-01 16:09:22 +0200
@@ -6,8 +6,13 @@
 
 #include <png.h>
 
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 #include "libvo/fastmemcpy.h"
 
 #include "vd_internal.h"
diff -urN mplayer-svn-r21410.orig/libmpcodecs/vd_mtga.c mplayer-svn-r21410/libmpcodecs/vd_mtga.c
--- mplayer-svn-r21410.orig/libmpcodecs/vd_mtga.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/libmpcodecs/vd_mtga.c	2006-12-01 16:09:22 +0200
@@ -10,8 +10,13 @@
 #include "config.h"
 #include "mp_msg.h"
 
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 #include "libvo/fastmemcpy.h"
 
 #include "vd_internal.h"
diff -urN mplayer-svn-r21410.orig/libmpcodecs/vd_qtvideo.c mplayer-svn-r21410/libmpcodecs/vd_qtvideo.c
--- mplayer-svn-r21410.orig/libmpcodecs/vd_qtvideo.c	2006-11-27 14:05:37 +0200
+++ mplayer-svn-r21410/libmpcodecs/vd_qtvideo.c	2006-12-01 16:09:22 +0200
@@ -28,7 +28,11 @@
 
 LIBVD_EXTERN(qtvideo)
 
-#include "bswap.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/bswap.h"
+#endif
 
 #ifndef MACOSX
 #include "qtx/qtxsdk/components.h"
diff -urN mplayer-svn-r21410.orig/libmpcodecs/vd_sgi.c mplayer-svn-r21410/libmpcodecs/vd_sgi.c
--- mplayer-svn-r21410.orig/libmpcodecs/vd_sgi.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/libmpcodecs/vd_sgi.c	2006-12-01 16:09:22 +0200
@@ -7,8 +7,13 @@
 
 #include "config.h"
 #include "mp_msg.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 #include "vd_internal.h"
 
 #define SGI_HEADER_LEN 512
diff -urN mplayer-svn-r21410.orig/libmpcodecs/vd_xanim.c mplayer-svn-r21410/libmpcodecs/vd_xanim.c
--- mplayer-svn-r21410.orig/libmpcodecs/vd_xanim.c	2006-06-22 14:19:47 +0300
+++ mplayer-svn-r21410/libmpcodecs/vd_xanim.c	2006-12-01 16:09:22 +0200
@@ -37,7 +37,11 @@
 #include <errno.h> /* strerror, errno */
 
 #include "mp_msg.h"
-#include "bswap.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/bswap.h"
+#endif
 
 #include "osdep/timer.h"
 #include "libvo/fastmemcpy.h"
diff -urN mplayer-svn-r21410.orig/libmpcodecs/ve_qtvideo.c mplayer-svn-r21410/libmpcodecs/ve_qtvideo.c
--- mplayer-svn-r21410.orig/libmpcodecs/ve_qtvideo.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/libmpcodecs/ve_qtvideo.c	2006-12-01 16:09:22 +0200
@@ -10,8 +10,13 @@
 
 #include "config.h"
 #include "mp_msg.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 
 #ifdef WIN32_LOADER 
 #include "ldt_keeper.h" 
diff -urN mplayer-svn-r21410.orig/libmpcodecs/vf_divtc.c mplayer-svn-r21410/libmpcodecs/vf_divtc.c
--- mplayer-svn-r21410.orig/libmpcodecs/vf_divtc.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/libmpcodecs/vf_divtc.c	2006-12-01 16:09:22 +0200
@@ -7,8 +7,13 @@
 #include "config.h"
 #include "mp_msg.h"
 #include "cpudetect.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 
 #include "img_format.h"
 #include "mp_image.h"
diff -urN mplayer-svn-r21410.orig/libmpcodecs/vf_halfpack.c mplayer-svn-r21410/libmpcodecs/vf_halfpack.c
--- mplayer-svn-r21410.orig/libmpcodecs/vf_halfpack.c	2006-08-17 13:36:26 +0300
+++ mplayer-svn-r21410/libmpcodecs/vf_halfpack.c	2006-12-01 16:09:22 +0200
@@ -12,7 +12,12 @@
 #include "vf.h"
 
 #include "libvo/fastmemcpy.h"
+#ifdef USE_LIBSWSCALE_SO
+#include <ffmpeg/rgb2rgb.h>
+#else
 #include "libswscale/rgb2rgb.h"
+#endif
+
 
 struct vf_priv_s {
 	int field;
diff -urN mplayer-svn-r21410.orig/libmpcodecs/vf_palette.c mplayer-svn-r21410/libmpcodecs/vf_palette.c
--- mplayer-svn-r21410.orig/libmpcodecs/vf_palette.c	2006-07-03 14:16:54 +0300
+++ mplayer-svn-r21410/libmpcodecs/vf_palette.c	2006-12-01 16:09:22 +0200
@@ -11,7 +11,11 @@
 #include "mp_image.h"
 #include "vf.h"
 
+#ifdef USE_LIBSWSCALE_SO
+#include <ffmpeg/rgb2rgb.h>
+#else
 #include "libswscale/rgb2rgb.h"
+#endif
 
 //===========================================================================//
 
diff -urN mplayer-svn-r21410.orig/libmpcodecs/vf_rgb2bgr.c mplayer-svn-r21410/libmpcodecs/vf_rgb2bgr.c
--- mplayer-svn-r21410.orig/libmpcodecs/vf_rgb2bgr.c	2006-07-03 14:16:54 +0300
+++ mplayer-svn-r21410/libmpcodecs/vf_rgb2bgr.c	2006-12-01 16:09:22 +0200
@@ -11,7 +11,12 @@
 #include "vf.h"
 
 #include "libvo/fastmemcpy.h"
+#ifdef USE_LIBSWSCALE_SO
+#include <ffmpeg/rgb2rgb.h>
+#else
 #include "libswscale/rgb2rgb.h"
+#endif
+
 
 //===========================================================================//
 
diff -urN mplayer-svn-r21410.orig/libmpcodecs/vf_sab.c mplayer-svn-r21410/libmpcodecs/vf_sab.c
--- mplayer-svn-r21410.orig/libmpcodecs/vf_sab.c	2006-09-18 11:03:58 +0300
+++ mplayer-svn-r21410/libmpcodecs/vf_sab.c	2006-12-01 16:09:22 +0200
@@ -29,12 +29,20 @@
 #include <malloc.h>
 #endif
 
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/avutil.h>
+#else
 #include "avutil.h"
+#endif
 #include "img_format.h"
 #include "mp_image.h"
 #include "vf.h"
 #include "libvo/fastmemcpy.h"
+#ifdef USE_LIBSWSCALE_SO
+#include <ffmpeg/swscale.h>
+#else
 #include "libswscale/swscale.h"
+#endif
 #include "vf_scale.h"
 
 
diff -urN mplayer-svn-r21410.orig/libmpcodecs/vf_scale.c mplayer-svn-r21410/libmpcodecs/vf_scale.c
--- mplayer-svn-r21410.orig/libmpcodecs/vf_scale.c	2006-09-18 11:03:58 +0300
+++ mplayer-svn-r21410/libmpcodecs/vf_scale.c	2006-12-01 16:09:22 +0200
@@ -13,7 +13,11 @@
 #include "fmt-conversion.h"
 
 #include "libvo/fastmemcpy.h"
+#ifdef USE_LIBSWSCALE_SO
+#include <ffmpeg/swscale.h>
+#else
 #include "libswscale/swscale.h"
+#endif
 #include "vf_scale.h"
 
 #include "m_option.h"
diff -urN mplayer-svn-r21410.orig/libmpcodecs/vf_screenshot.c mplayer-svn-r21410/libmpcodecs/vf_screenshot.c
--- mplayer-svn-r21410.orig/libmpcodecs/vf_screenshot.c	2006-11-17 12:30:00 +0200
+++ mplayer-svn-r21410/libmpcodecs/vf_screenshot.c	2006-12-01 16:09:22 +0200
@@ -22,7 +22,11 @@
 #include "vf_scale.h"
 
 #include "libvo/fastmemcpy.h"
+#ifdef USE_LIBSWSCALE_SO
+#include <ffmpeg/swscale.h>
+#else
 #include "libswscale/swscale.h"
+#endif
 
 struct vf_priv_s {
     int frameno;
diff -urN mplayer-svn-r21410.orig/libmpcodecs/vf_smartblur.c mplayer-svn-r21410/libmpcodecs/vf_smartblur.c
--- mplayer-svn-r21410.orig/libmpcodecs/vf_smartblur.c	2006-09-18 11:03:58 +0300
+++ mplayer-svn-r21410/libmpcodecs/vf_smartblur.c	2006-12-01 16:09:22 +0200
@@ -29,12 +29,21 @@
 #include <malloc.h>
 #endif
 
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/avutil.h>
+#else
 #include "avutil.h"
+#endif
+
 #include "img_format.h"
 #include "mp_image.h"
 #include "vf.h"
 #include "libvo/fastmemcpy.h"
+#ifdef USE_LIBSWSCALE_SO
+#include <ffmpeg/swscale.h>
+#else
 #include "libswscale/swscale.h"
+#endif
 #include "vf_scale.h"
 
 //===========================================================================//
diff -urN mplayer-svn-r21410.orig/libmpcodecs/vf_yuy2.c mplayer-svn-r21410/libmpcodecs/vf_yuy2.c
--- mplayer-svn-r21410.orig/libmpcodecs/vf_yuy2.c	2006-07-03 14:16:54 +0300
+++ mplayer-svn-r21410/libmpcodecs/vf_yuy2.c	2006-12-01 16:09:22 +0200
@@ -12,7 +12,11 @@
 #include "vf.h"
 
 #include "libvo/fastmemcpy.h"
+#ifdef USE_LIBSWSCALE_SO
+#include <ffmpeg/rgb2rgb.h>
+#else
 #include "libswscale/rgb2rgb.h"
+#endif
 #include "vf_scale.h"
 
 //===========================================================================//
diff -urN mplayer-svn-r21410.orig/libmpdemux/asf.h mplayer-svn-r21410/libmpdemux/asf.h
--- mplayer-svn-r21410.orig/libmpdemux/asf.h	2006-11-29 17:14:35 +0200
+++ mplayer-svn-r21410/libmpdemux/asf.h	2006-12-01 16:09:22 +0200
@@ -3,8 +3,13 @@
 
 //#include "config.h"	/* for WORDS_BIGENDIAN */
 #include <inttypes.h>
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 
 #ifndef MIN
 #define MIN(a,b) (((a)<(b))?(a):(b))
diff -urN mplayer-svn-r21410.orig/libmpdemux/aviheader.h mplayer-svn-r21410/libmpdemux/aviheader.h
--- mplayer-svn-r21410.orig/libmpdemux/aviheader.h	2006-11-29 17:14:35 +0200
+++ mplayer-svn-r21410/libmpdemux/aviheader.h	2006-12-01 16:09:22 +0200
@@ -1,9 +1,14 @@
 #ifndef _aviheader_h
 #define	_aviheader_h
 
-//#include "config.h"	/* get correct definition WORDS_BIGENDIAN */
+#include "config.h"	/* get correct definition WORDS_BIGENDIAN */
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 
 #ifndef MIN
 #define MIN(a,b) (((a)<(b))?(a):(b))
diff -urN mplayer-svn-r21410.orig/libmpdemux/demux_aac.c mplayer-svn-r21410/libmpdemux/demux_aac.c
--- mplayer-svn-r21410.orig/libmpdemux/demux_aac.c	2006-06-20 13:10:58 +0300
+++ mplayer-svn-r21410/libmpdemux/demux_aac.c	2006-12-01 16:09:22 +0200
@@ -11,7 +11,11 @@
 #include "parse_es.h"
 #include "stheader.h"
 
-#include "bswap.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/bswap.h"
+#endif
 #include "ms_hdr.h"
 
 typedef struct {
diff -urN mplayer-svn-r21410.orig/libmpdemux/demux_lmlm4.c mplayer-svn-r21410/libmpdemux/demux_lmlm4.c
--- mplayer-svn-r21410.orig/libmpdemux/demux_lmlm4.c	2006-07-10 14:48:37 +0300
+++ mplayer-svn-r21410/libmpdemux/demux_lmlm4.c	2006-12-01 16:09:22 +0200
@@ -16,7 +16,11 @@
 #include "stream.h"
 #include "demuxer.h"
 #include "stheader.h"
-#include "bswap.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/bswap.h"
+#endif
 
 typedef struct __FrameInfo
 {
diff -urN mplayer-svn-r21410.orig/libmpdemux/demux_mkv.c mplayer-svn-r21410/libmpdemux/demux_mkv.c
--- mplayer-svn-r21410.orig/libmpdemux/demux_mkv.c	2006-11-27 14:05:42 +0200
+++ mplayer-svn-r21410/libmpdemux/demux_mkv.c	2006-12-01 16:09:22 +0200
@@ -18,7 +18,11 @@
 #include "stheader.h"
 #include "ebml.h"
 #include "matroska.h"
-#include "bswap.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/bswap.h"
+#endif
 
 #include "mp_msg.h"
 #include "help_mp.h"
diff -urN mplayer-svn-r21410.orig/libmpdemux/demux_mov.c mplayer-svn-r21410/libmpdemux/demux_mov.c
--- mplayer-svn-r21410.orig/libmpdemux/demux_mov.c	2006-11-29 12:06:38 +0200
+++ mplayer-svn-r21410/libmpdemux/demux_mov.c	2006-12-01 16:09:22 +0200
@@ -40,7 +40,11 @@
 #include "demuxer.h"
 #include "stheader.h"
 
-#include "bswap.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/bswap.h"
+#endif
 
 #include "libvo/sub.h"
 extern subtitle *vo_sub;
diff -urN mplayer-svn-r21410.orig/libmpdemux/demux_mpc.c mplayer-svn-r21410/libmpdemux/demux_mpc.c
--- mplayer-svn-r21410.orig/libmpdemux/demux_mpc.c	2006-11-29 17:14:35 +0200
+++ mplayer-svn-r21410/libmpdemux/demux_mpc.c	2006-12-01 16:09:22 +0200
@@ -11,8 +11,13 @@
 #include <stdio.h>
 #include <string.h>
 #include "mp_msg.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 #include "stream.h"
 #include "demuxer.h"
 #include "stheader.h"
diff -urN mplayer-svn-r21410.orig/libmpdemux/demux_pva.c mplayer-svn-r21410/libmpdemux/demux_pva.c
--- mplayer-svn-r21410.orig/libmpdemux/demux_pva.c	2006-06-13 15:12:29 +0300
+++ mplayer-svn-r21410/libmpdemux/demux_pva.c	2006-12-01 16:09:22 +0200
@@ -30,7 +30,11 @@
 #include "demuxer.h"
 #include "stheader.h"
 
-#include "bswap.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/bswap.h"
+#endif
 
 /*
  * #defines below taken from PVA spec (see URL above)
diff -urN mplayer-svn-r21410.orig/libmpdemux/demux_realaud.c mplayer-svn-r21410/libmpdemux/demux_realaud.c
--- mplayer-svn-r21410.orig/libmpdemux/demux_realaud.c	2006-07-14 13:44:19 +0300
+++ mplayer-svn-r21410/libmpdemux/demux_realaud.c	2006-12-01 16:09:22 +0200
@@ -14,8 +14,11 @@
 #include "stream.h"
 #include "demuxer.h"
 #include "stheader.h"
-#include "bswap.h"
-
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/bswap.h"
+#endif
 
 #define FOURCC_DOTRA mmioFOURCC('.','r','a', 0xfd)
 #define FOURCC_144 mmioFOURCC('1','4','_','4')
diff -urN mplayer-svn-r21410.orig/libmpdemux/demux_real.c mplayer-svn-r21410/libmpdemux/demux_real.c
--- mplayer-svn-r21410.orig/libmpdemux/demux_real.c	2006-11-17 12:30:07 +0200
+++ mplayer-svn-r21410/libmpdemux/demux_real.c	2006-12-01 16:09:22 +0200
@@ -31,7 +31,11 @@
 #include "stream.h"
 #include "demuxer.h"
 #include "stheader.h"
-#include "bswap.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/bswap.h"
+#endif
 
 #ifdef USE_LIBAVCODEC_SO
 #include <ffmpeg/avcodec.h>
diff -urN mplayer-svn-r21410.orig/libmpdemux/demux_smjpeg.c mplayer-svn-r21410/libmpdemux/demux_smjpeg.c
--- mplayer-svn-r21410.orig/libmpdemux/demux_smjpeg.c	2006-06-13 15:12:29 +0300
+++ mplayer-svn-r21410/libmpdemux/demux_smjpeg.c	2006-12-01 16:09:22 +0200
@@ -20,7 +20,11 @@
 #include "stream.h"
 #include "demuxer.h"
 #include "stheader.h"
-#include "bswap.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/bswap.h"
+#endif
 
 static int smjpeg_check_file(demuxer_t* demuxer){
     int orig_pos = stream_tell(demuxer->stream);
diff -urN mplayer-svn-r21410.orig/libmpdemux/demux_ts.c mplayer-svn-r21410/libmpdemux/demux_ts.c
--- mplayer-svn-r21410.orig/libmpdemux/demux_ts.c	2006-11-21 15:13:48 +0200
+++ mplayer-svn-r21410/libmpdemux/demux_ts.c	2006-12-01 16:09:22 +0200
@@ -34,7 +34,11 @@
 #include "parse_es.h"
 #include "stheader.h"
 
-#include "bswap.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/bswap.h"
+#endif
 #include "unrarlib.h"
 #include "ms_hdr.h"
 #include "mpeg_hdr.h"
diff -urN mplayer-svn-r21410.orig/libmpdemux/demux_viv.c mplayer-svn-r21410/libmpdemux/demux_viv.c
--- mplayer-svn-r21410.orig/libmpdemux/demux_viv.c	2006-07-17 10:28:57 +0300
+++ mplayer-svn-r21410/libmpdemux/demux_viv.c	2006-12-01 16:09:22 +0200
@@ -13,7 +13,11 @@
 #include "stream.h"
 #include "demuxer.h"
 #include "stheader.h"
-#include "bswap.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/bswap.h"
+#endif
 
 #ifdef USE_LIBAVCODEC_SO
 #include <ffmpeg/avcodec.h>
diff -urN mplayer-svn-r21410.orig/libmpdemux/demux_vqf.c mplayer-svn-r21410/libmpdemux/demux_vqf.c
--- mplayer-svn-r21410.orig/libmpdemux/demux_vqf.c	2006-11-29 17:14:35 +0200
+++ mplayer-svn-r21410/libmpdemux/demux_vqf.c	2006-12-01 16:09:22 +0200
@@ -2,8 +2,13 @@
 
 #include <stdlib.h>
 #include <stdio.h>
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 
 #include "stream.h"
 #include "demuxer.h"
diff -urN mplayer-svn-r21410.orig/libmpdemux/demux_y4m.c mplayer-svn-r21410/libmpdemux/demux_y4m.c
--- mplayer-svn-r21410.orig/libmpdemux/demux_y4m.c	2006-06-13 15:12:29 +0300
+++ mplayer-svn-r21410/libmpdemux/demux_y4m.c	2006-12-01 16:09:22 +0200
@@ -15,7 +15,11 @@
 //#include "stream.h"
 #include "demuxer.h"
 #include "stheader.h"
-#include "bswap.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/bswap.h"
+#endif
 
 typedef struct {
     int framenum; 
diff -urN mplayer-svn-r21410.orig/libmpdemux/ebml.c mplayer-svn-r21410/libmpdemux/ebml.c
--- mplayer-svn-r21410.orig/libmpdemux/ebml.c	2006-12-01 15:23:05 +0200
+++ mplayer-svn-r21410/libmpdemux/ebml.c	2006-12-01 16:11:15 +0200
@@ -11,9 +11,15 @@
 
 #include "stream.h"
 #include "ebml.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#include <ffmpeg/intfloat_readwrite.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
 #include "libavutil/intfloat_readwrite.h"
+#endif
 
 
 #ifndef SIZE_MAX
diff -urN mplayer-svn-r21410.orig/libmpdemux/muxer_avi.c mplayer-svn-r21410/libmpdemux/muxer_avi.c
--- mplayer-svn-r21410.orig/libmpdemux/muxer_avi.c	2006-09-24 19:47:48 +0300
+++ mplayer-svn-r21410/libmpdemux/muxer_avi.c	2006-12-01 16:09:22 +0200
@@ -12,7 +12,11 @@
 #include "demuxer.h"
 #include "stheader.h"
 
-#include "bswap.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/bswap.h"
+#endif
 
 #include "muxer.h"
 #include "aviheader.h"
diff -urN mplayer-svn-r21410.orig/libmpdemux/muxer_rawvideo.c mplayer-svn-r21410/libmpdemux/muxer_rawvideo.c
--- mplayer-svn-r21410.orig/libmpdemux/muxer_rawvideo.c	2006-06-13 15:12:29 +0300
+++ mplayer-svn-r21410/libmpdemux/muxer_rawvideo.c	2006-12-01 16:09:22 +0200
@@ -14,7 +14,11 @@
 #include "aviheader.h"
 #include "ms_hdr.h"
 
-#include "bswap.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/bswap.h"
+#endif
 
 #include "muxer.h"
 
diff -urN mplayer-svn-r21410.orig/libmpdemux/nuppelvideo.h mplayer-svn-r21410/libmpdemux/nuppelvideo.h
--- mplayer-svn-r21410.orig/libmpdemux/nuppelvideo.h	2006-11-29 12:06:38 +0200
+++ mplayer-svn-r21410/libmpdemux/nuppelvideo.h	2006-12-01 16:09:22 +0200
@@ -1,6 +1,10 @@
 /* nuppelvideo.h  rh */
 
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/intfloat_readwrite.h>
+#else
 #include "libavutil/intfloat_readwrite.h"
+#endif
 
 typedef struct  __attribute__((packed)) rtfileheader
 {
diff -urN mplayer-svn-r21410.orig/libswscale/rgb2rgb.c mplayer-svn-r21410/libswscale/rgb2rgb.c
--- mplayer-svn-r21410.orig/libswscale/rgb2rgb.c	2006-11-20 12:43:26 +0200
+++ mplayer-svn-r21410/libswscale/rgb2rgb.c	2006-12-01 16:09:22 +0200
@@ -32,7 +32,11 @@
 #include "swscale.h"
 #include "swscale_internal.h"
 #include "x86_cpu.h"
-#include "bswap.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/bswap.h"
+#endif
 #ifdef USE_FASTMEMCPY
 #include "libvo/fastmemcpy.h"
 #endif
diff -urN mplayer-svn-r21410.orig/libswscale/swscale.c mplayer-svn-r21410/libswscale/swscale.c
--- mplayer-svn-r21410.orig/libswscale/swscale.c	2006-11-20 12:43:26 +0200
+++ mplayer-svn-r21410/libswscale/swscale.c	2006-12-01 16:09:22 +0200
@@ -75,7 +75,11 @@
 #include "swscale.h"
 #include "swscale_internal.h"
 #include "x86_cpu.h"
-#include "bswap.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/bswap.h"
+#endif
 #include "rgb2rgb.h"
 #ifdef USE_FASTMEMCPY
 #include "libvo/fastmemcpy.h"
diff -urN mplayer-svn-r21410.orig/libswscale/swscale-example.c mplayer-svn-r21410/libswscale/swscale-example.c
--- mplayer-svn-r21410.orig/libswscale/swscale-example.c	2006-11-02 12:29:44 +0200
+++ mplayer-svn-r21410/libswscale/swscale-example.c	2006-12-01 16:09:22 +0200
@@ -25,7 +25,11 @@
 #include <stdarg.h>
 
 #undef HAVE_AV_CONFIG_H
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/avutil.h>
+#else
 #include "avutil.h"
+#endif
 #include "swscale.h"
 #include "swscale_internal.h"
 #include "rgb2rgb.h"
diff -urN mplayer-svn-r21410.orig/libswscale/swscale_internal.h mplayer-svn-r21410/libswscale/swscale_internal.h
--- mplayer-svn-r21410.orig/libswscale/swscale_internal.h	2006-11-20 12:43:26 +0200
+++ mplayer-svn-r21410/libswscale/swscale_internal.h	2006-12-01 16:09:22 +0200
@@ -25,7 +25,11 @@
 #include <altivec.h>
 #endif
 
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/avutil.h>
+#else
 #include "avutil.h"
+#endif
 
 #ifdef CONFIG_DARWIN
 #define AVV(x...) (x)
diff -urN mplayer-svn-r21410.orig/libvo/font_load_ft.c mplayer-svn-r21410/libvo/font_load_ft.c
--- mplayer-svn-r21410.orig/libvo/font_load_ft.c	2006-11-29 17:14:35 +0200
+++ mplayer-svn-r21410/libvo/font_load_ft.c	2006-12-01 16:09:22 +0200
@@ -28,8 +28,13 @@
 #include <fontconfig/fontconfig.h>
 #endif
 
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 #include "font_load.h"
 #include "mp_msg.h"
 #include "mplayer.h"
diff -urN mplayer-svn-r21410.orig/libvo/mga_common.c mplayer-svn-r21410/libvo/mga_common.c
--- mplayer-svn-r21410.orig/libvo/mga_common.c	2006-07-03 14:16:55 +0300
+++ mplayer-svn-r21410/libvo/mga_common.c	2006-12-01 16:09:22 +0200
@@ -1,7 +1,11 @@
 
 #include "fastmemcpy.h"
 #include "cpudetect.h"
+#ifdef USE_LIBSWSCALE_SO
+#include <ffmpeg/swscale.h>
+#else
 #include "libswscale/swscale.h"
+#endif
 #include "libmpcodecs/vf_scale.h"
 #include "mp_msg.h"
 #include "help_mp.h"
diff -urN mplayer-svn-r21410.orig/libvo/sub.c mplayer-svn-r21410/libvo/sub.c
--- mplayer-svn-r21410.orig/libvo/sub.c	2006-11-29 17:14:35 +0200
+++ mplayer-svn-r21410/libvo/sub.c	2006-12-01 16:09:22 +0200
@@ -20,7 +20,12 @@
 #include "font_load.h"
 #include "sub.h"
 #include "spudec.h"
+
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#else
 #include "libavutil/common.h"
+#endif
 
 #define NEW_SPLITTING
 
diff -urN mplayer-svn-r21410.orig/libvo/vo_aa.c mplayer-svn-r21410/libvo/vo_aa.c
--- mplayer-svn-r21410.orig/libvo/vo_aa.c	2006-11-27 14:05:38 +0200
+++ mplayer-svn-r21410/libvo/vo_aa.c	2006-12-01 16:09:22 +0200
@@ -27,7 +27,11 @@
 #include "video_out.h"
 #include "video_out_internal.h"
 #include "aspect.h"
+#ifdef USE_LIBSWSCALE_SO
+#include <ffmpeg/swscale.h>
+#else
 #include "libswscale/swscale.h"
+#endif
 #include "libmpcodecs/vf_scale.h"
 #include "font_load.h"
 #include "sub.h"
diff -urN mplayer-svn-r21410.orig/libvo/vo_vesa.c mplayer-svn-r21410/libvo/vo_vesa.c
--- mplayer-svn-r21410.orig/libvo/vo_vesa.c	2006-12-01 15:23:05 +0200
+++ mplayer-svn-r21410/libvo/vo_vesa.c	2006-12-01 16:12:52 +0200
@@ -39,8 +39,13 @@
 
 #include "fastmemcpy.h"
 #include "sub.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 #include "aspect.h"
 #include "vesa_lvo.h"
 #ifdef CONFIG_VIDIX
@@ -48,7 +53,11 @@
 #endif
 #include "mp_msg.h"
 
+#ifdef USE_LIBSWSCALE_SO
+#include <ffmpeg/swscale.h>
+#else
 #include "libswscale/swscale.h"
+#endif
 #include "libmpcodecs/vf_scale.h"
 
 
diff -urN mplayer-svn-r21410.orig/libvo/vo_x11.c mplayer-svn-r21410/libvo/vo_x11.c
--- mplayer-svn-r21410.orig/libvo/vo_x11.c	2006-10-25 19:49:02 +0300
+++ mplayer-svn-r21410/libvo/vo_x11.c	2006-12-01 16:09:22 +0200
@@ -38,7 +38,11 @@
 #include "fastmemcpy.h"
 #include "sub.h"
 
+#ifdef USE_LIBSWSCALE_SO
+#include <ffmpeg/swscale.h>
+#else
 #include "libswscale/swscale.h"
+#endif
 #include "libmpcodecs/vf_scale.h"
 #define MODE_RGB  0x1
 #define MODE_BGR  0x2
diff -urN mplayer-svn-r21410.orig/libvo/vo_yuv4mpeg.c mplayer-svn-r21410/libvo/vo_yuv4mpeg.c
--- mplayer-svn-r21410.orig/libvo/vo_yuv4mpeg.c	2006-10-26 12:45:00 +0300
+++ mplayer-svn-r21410/libvo/vo_yuv4mpeg.c	2006-12-01 16:09:22 +0200
@@ -39,10 +39,19 @@
 #include "sub.h"
 
 #include "fastmemcpy.h"
+#ifdef USE_LIBSWSCALE_SO
+#include <ffmpeg/swscale.h>
+#include <ffmpeg/rgb2rgb.h>
+#else
 #include "libswscale/swscale.h"
 #include "libswscale/rgb2rgb.h"
+#endif
 #include "libmpcodecs/vf_scale.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/rational.h>
+#else
 #include "libavutil/rational.h"
+#endif
 
 static vo_info_t info = 
 {
diff -urN mplayer-svn-r21410.orig/Makefile mplayer-svn-r21410/Makefile
--- mplayer-svn-r21410.orig/Makefile	2006-12-01 15:23:05 +0200
+++ mplayer-svn-r21410/Makefile	2006-12-01 16:09:22 +0200
@@ -55,7 +55,7 @@
               libaf/libaf.a \
               libmpdemux/libmpdemux.a \
               stream/stream.a \
-              libswscale/libswscale.a \
+              $(SWSCALE_LIB) \
               libvo/libosd.a \
 
 LIBS_MPLAYER = libvo/libvo.a \
@@ -93,6 +93,8 @@
 PARTS-$(CONFIG_LIBAVUTIL)         += libavutil
 COMMON_LIBS-$(CONFIG_LIBPOSTPROC) += libpostproc/libpostproc.a
 PARTS-$(CONFIG_LIBPOSTPROC)       += libpostproc
+COMMON_LIBS-$(CONFIG_LIBSWSCALE)  += libswscale/libswscale.a
+PARTS-$(CONFIG_LIBSWSCALE)        += libswscale
 COMMON_LIBS-$(WIN32DLL)           += loader/libloader.a
 PARTS-$(WIN32DLL)                 += loader
 COMMON_LIBS-$(MP3LIB)             += mp3lib/libMP3.a
diff -urN mplayer-svn-r21410.orig/mp3lib/sr1.c mplayer-svn-r21410/mp3lib/sr1.c
--- mplayer-svn-r21410.orig/mp3lib/sr1.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/mp3lib/sr1.c	2006-12-01 16:09:22 +0200
@@ -24,8 +24,13 @@
 #include "mpg123.h"
 #include "huffman.h"
 #include "mp3.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 #include "cpudetect.h"
 //#include "liba52/mm_accel.h"
 #include "mp_msg.h"
diff -urN mplayer-svn-r21410.orig/osdep/swab.c mplayer-svn-r21410/osdep/swab.c
--- mplayer-svn-r21410.orig/osdep/swab.c	2006-06-13 15:11:56 +0300
+++ mplayer-svn-r21410/osdep/swab.c	2006-12-01 16:09:22 +0200
@@ -2,7 +2,11 @@
 
 #ifndef	HAVE_SWAB
 /* system has no swab.  emulate via bswap */
-#include "bswap.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/bswap.h"
+#endif
 #include <unistd.h>
 
 void swab(const void *from, void *to, ssize_t n) {
diff -urN mplayer-svn-r21410.orig/spudec.c mplayer-svn-r21410/spudec.c
--- mplayer-svn-r21410.orig/spudec.c	2006-09-18 11:04:02 +0300
+++ mplayer-svn-r21410/spudec.c	2006-12-01 16:09:22 +0200
@@ -23,8 +23,17 @@
 #include <math.h>
 #include "libvo/video_out.h"
 #include "spudec.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/avutil.h>
+#else
 #include "avutil.h"
+#endif
+#ifdef USE_LIBSWSCALE_SO
+#include <ffmpeg/swscale.h>
+#else
 #include "libswscale/swscale.h"
+#endif
+
 
 #define MIN(a, b)	((a)<(b)?(a):(b))
 
diff -urN mplayer-svn-r21410.orig/stream/realrtsp/real.c mplayer-svn-r21410/stream/realrtsp/real.c
--- mplayer-svn-r21410.orig/stream/realrtsp/real.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/stream/realrtsp/real.c	2006-12-01 16:09:22 +0200
@@ -31,17 +31,19 @@
 #include <string.h>
 
 #include "../config.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#include "ffmpeg/md5.h"
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#include "libavutil/md5.h"
+#endif
 #include "real.h"
 #include "asmrp.h"
 #include "sdpplin.h"
 #include "xbuffer.h"
-#if USE_LIBAVUTIL_SO
-#include "ffmpeg/md5.h"
-#else
-#include "libavutil/md5.h"
-#endif
 #include "../http.h"
 #include "mp_msg.h"
 
diff -urN mplayer-svn-r21410.orig/stream/stream_cdda.c mplayer-svn-r21410/stream/stream_cdda.c
--- mplayer-svn-r21410.orig/stream/stream_cdda.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/stream/stream_cdda.c	2006-12-01 16:09:22 +0200
@@ -3,8 +3,13 @@
 #include "stream.h"
 #include "m_option.h"
 #include "m_struct.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 
 #include <stdio.h>
 #include <stdlib.h>
diff -urN mplayer-svn-r21410.orig/stream/stream_dvdnav.c mplayer-svn-r21410/stream/stream_dvdnav.c
--- mplayer-svn-r21410.orig/stream/stream_dvdnav.c	2006-11-28 12:50:09 +0200
+++ mplayer-svn-r21410/stream/stream_dvdnav.c	2006-12-01 16:09:22 +0200
@@ -11,7 +11,11 @@
 #include "libmpdemux/demuxer.h"
 #include "stream_dvdnav.h"
 #include "libvo/video_out.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#else
 #include "libavutil/common.h"
+#endif
 #include "spudec.h"
 #include "m_option.h"
 #include "m_struct.h"
diff -urN mplayer-svn-r21410.orig/stream/stream_netstream.c mplayer-svn-r21410/stream/stream_netstream.c
--- mplayer-svn-r21410.orig/stream/stream_netstream.c	2006-11-29 17:14:34 +0200
+++ mplayer-svn-r21410/stream/stream_netstream.c	2006-12-01 16:09:22 +0200
@@ -60,8 +60,13 @@
 #include "help_mp.h"
 #include "m_option.h"
 #include "m_struct.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
 #include "libavutil/common.h"
 #include "libavutil/bswap.h"
+#endif
 
 #include "netstream.h"
 #include "tcp.h"
diff -urN mplayer-svn-r21410.orig/TOOLS/Makefile mplayer-svn-r21410/TOOLS/Makefile
--- mplayer-svn-r21410.orig/TOOLS/Makefile	2006-11-27 14:05:41 +0200
+++ mplayer-svn-r21410/TOOLS/Makefile	2006-12-01 16:09:22 +0200
@@ -27,8 +27,7 @@
 
 subrip: subrip.c
 	$(CC) $(CFLAGS) -g -o $@ $< ../vobsub.o ../spudec.o ../mp_msg.o \
-          ../unrarlib.o ../libswscale/swscale.o ../libswscale/rgb2rgb.o \
-          ../libswscale/yuv2rgb.o ../libmpcodecs/img_format.o -lm
+          ../unrarlib.o ../libmpcodecs/img_format.o -L../libswscale -lswscale -lm
 
 vivodump: vivodump.c
 	$(CC) $(CFLAGS) -o $@ $< ../mp_msg.o ../libmpdemux/libmpdemux.a ../stream/stream.a
diff -urN mplayer-svn-r21410.orig/TOOLS/subfont-c/subfont.c mplayer-svn-r21410/TOOLS/subfont-c/subfont.c
--- mplayer-svn-r21410.orig/TOOLS/subfont-c/subfont.c	2006-06-13 15:12:11 +0300
+++ mplayer-svn-r21410/TOOLS/subfont-c/subfont.c	2006-12-01 16:09:22 +0200
@@ -25,8 +25,14 @@
 #include <freetype/ftglyph.h>
 #endif
 
-
-#include "bswap.h"
+#include "config.h"
+#ifdef USE_LIBAVUTIL_SO
+#include <ffmpeg/common.h>
+#include <ffmpeg/bswap.h>
+#else
+#include "libavutil/common.h"
+#include "libavutil/bswap.h"
+#endif
 #include "osdep/timer.h"
 
 #ifndef DEBUG
